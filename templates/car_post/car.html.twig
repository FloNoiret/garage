{% extends 'base.html.twig' %}

{# Change page title #}
{% block title %}Véhicules d'Occasion
{% endblock %}

{% block body %}
	{% if app.user %}
		<div class=" d-flex justify-content-center mt-2">
			<a href="/vehicules/new" class="btn btn-danger mt-3">Ajouter un véhicule</a>
		</div>
	{% else %}

		<div
			class="d-flex justify-content-around flex-wrap container">

			{# Filters #}
			<form id="filter-form" class="mt-3">

				<label for="max-price">Prix Max. :</label>
				<span id="max-price-value"></span>
				€
				<input type="range" class="form-range" min="0" max="150000" step="1000" name="max_price" id="max-price" onchange="updateRangeValue(this, 'max-price-value')">
				<br>

				<label for="max-kilometer">
					Kilométrage Max. :</label>
				<span id="max-kilometer-value"></span>
				km
				<input type="range" class="form-range" min="0" max="200000" step="10000" name="max_kilometer" id="max-kilometer" onchange="updateRangeValue(this, 'max-kilometer-value')">


				<button type="submit" class="btn btn-danger m-2">Filtrer</button>
			</form>

		</div>
	{% endif %}


	<section>
		<ul id="car-list" class="d-flex justify-content-around flex-wrap mt-1">
			{% for carpost in carposts %}

				{# Car Post Card #}


				<div
					class="card m-5" style="width: 18rem;">
					{# Carrousel TO DO 
																																																																																																																																																																							<div id="{{carpost.title|slug }}" class="carousel slide" data-bs-interval="false">
																																																																																																																																																																								<div class="carousel-inner">
																																																																																																																																																																									<div class="carousel-item active">
																																																																																																																																																																										<img class="d-block w-100" src={{ asset('/assets/CarImage/')~carpost.image.name}} class="card-img-top" alt="voiture de sport">
																																																																																																																																																																									</div>
																																																																																																																																																																									<div class="carousel-item">
																																																																																																																																																																										<img class="d-block w-100" src="https://images.pexels.com/photos/3593922/pexels-photo-3593922.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Second slide">
																																																																																																																																																																									</div>
																																																																																																																																																																									<div class="carousel-item">
																																																																																																																																																																										<img class="d-block w-100" src="https://images.pexels.com/photos/3422964/pexels-photo-3422964.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Third slide">
																																																																																																																																																																									</div>
																																																																																																																																																																								</div>
																																																																																																																																																																								<a class="carousel-control-prev" href="#{{carpost.title|slug  }}" role="button" data-bs-slide="prev">
																																																																																																																																																																									<span class="carousel-control-prev-icon" aria-hidden="true"></span>
																																																																																																																																																																								</a>
																																																																																																																																																																								<a class="carousel-control-next" href="#{{carpost.title|slug  }}" role="button" data-bs-slide="next">
																																																																																																																																																																									<span class="carousel-control-next-icon" aria-hidden="true"></span>
																																																																																																																																																																								</a> 
																																																																																																																																																																						</div> #}


					<img src={{ asset('/assets/CarImage/')~carpost.image.name}} alt="{{carpost.title}}">

					<div class="card-body">
						<h5 class="card-title">{{carpost.title}}</h5>
						<p class="card-text">{{carpost.content}}</p>
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<b>
								Prix
							</b>
							<br>{{carpost.price}}
							€</li>
						<li class="list-group-item">
							<b>
								Kilométrage
							</b>
							<br>
							{{carpost.kilometer}}
							km</li>
						<li class="list-group-item">
							<b>
								Mise en circulation
							</b>
							<br>{{carpost.year|date('Y-m-d')| slice(0, 4) }}</li>
					</li>


					{# Display Options #}
					<li class="list-group-item">
						<a data-bs-toggle="collapse" href="#options-{{ carpost.id }}" role="button" aria-expanded="false" aria-controls="collapseExample">
							Voir les Options
						</a>
					</li>

					<ul class="collapse text-center list-group" id="options-{{ carpost.id }}">
						{% for reponse in carpost.reponses %}
							<li class="list-group-item">
								{{ reponse.libelle }}
							</li>
						{% endfor %}
					</ul>

					{# Display Characteristics #}
					<li class="list-group-item">
						<a data-bs-toggle="collapse" href="#characteristics-{{ carpost.id }}" role="button" aria-expanded="false" aria-controls="collapseExample">
							Voir les Caracteristiques
						</a>
					</li>


					<div class="collapse text-center list-group" id="characteristics-{{ carpost.id }}">


						<table class="table table-bordered">
							{% for characteristic in carpost.characteristics %}
								<tr>

									<td>
										{{ characteristic.libelle }}
									</td>
									<td>
										{{ characteristic.info }}
									</td>

								</tr>
							{% endfor %}
						</table>
					</div>

					{# Manage Car post #}
					{% if app.user %}
						<div class="card-body">
							<a href="{{ path('delete-vehicule', {'id':carpost.id}) }}" class="btn btn-danger">Supprimer</a>
							<a href="{{ path('edit-vehicule', {'id':carpost.id}) }}" class="btn btn-warning">Modifier</a>
						</div>

					{% else %}
						{# Contact Info + Form #}
						<li class="list-group-item">
							<a data-bs-toggle="collapse" href="#contact-{{ carpost.id }}" role="button" aria-expanded="false" aria-controls="collapseExample">
								Une question ?
							</a>
						</li>

						<ul class="collapse text-center list-group" id="contact-{{ carpost.id }}">
							<li class="list-group-item">Contactez-nous directement au
								<br>
								<a href="tel:+33102030405">01 02 03 04 05
								</a>
							</li>
							<li class="list-group-item">
								Ou envoyez-nous un message
								{{ render(controller('App\\Controller\\ContactController::renderDemand')) }}
							</li>
						</ul>
					{% endif %}
				</div>
			{% endfor %}
		</ul>
	</section>


	{# Filters JS Script - TO MOVE #}
	<script>
		// Submission of the filter form to get associated data

document.addEventListener('DOMContentLoaded', function () {
const form = document.getElementById('filter-form');
const carList = document.getElementById('car-list');

form.addEventListener('submit', function (event) {
event.preventDefault(); // Empêche la soumission par défaut du formulaire

const formData = new FormData(form);
const url = '{{ path('car_list_filtered') }}';

fetch(url, {
method: 'POST',
body: formData
}).then(response => response.text()).then(data => {
carList.innerHTML = data;
}).catch(error => {
console.error('Erreur :', error);
});
});
});

// Set  price & kilometer filter to its maximum value as the default
const maxPriceInput = document.getElementById('max-price');
maxPriceInput.value = maxPriceInput.max;

const maxKilometerInput = document.getElementById('max-kilometer');
maxKilometerInput.value = maxKilometerInput.max;

// Display the default value
updateRangeValue(maxPriceInput, 'max-price-value');

updateRangeValue(maxKilometerInput, 'max-kilometer-value');


// Display input value in filter
function updateRangeValue(input, outputId) {
document.getElementById(outputId).textContent = input.value;
}

	</script>
{% endblock %}
